{% load static %}
{% static 'img/default-avatar.png' as default_avatar %}

<div id="comment-{{ comment.pk }}" class="comment-item mb-3 d-flex">
  <div class="me-2">
    <img src="{{ comment.user.profile.avatar.url|default:default_avatar }}"
         alt="{{ comment.user.username }}"
         class="rounded-circle" width="40" height="40"
         onerror="this.onerror=null;this.src='{{ default_avatar }}';" />
  </div>

  <div class="flex-grow-1">
    <div class="d-flex align-items-center">
      <div class="author-block">
        <strong class="me-2">{{ comment.user.get_full_name|default:comment.user.username }}</strong>
        <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
        {% if comment.updated_at %}
          <small class="text-muted ms-2">(edited)</small>
        {% endif %}
      </div>
    </div>

    <div class="mt-2 comment-body">
      {% if comment.is_active %}
        <p class="mb-1">{{ comment.content|linebreaksbr }}</p>
      {% else %}
        <em class="text-muted">Comment removed by user or moderator.</em>
      {% endif %}
    </div>

    {% if user.is_authenticated %}
      {% if user == comment.user or user.is_staff %}
        <div class="comment-actions mt-2 d-flex gap-2">
          <a href="{% url 'comments:edit' comment.pk %}" class="btn btn-sm btn-outline-secondary">Edit</a>

          <form action="{% url 'comments:delete' comment.pk %}"
                method="post"
                class="comment-delete-form d-inline-block m-0">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
          </form>
        </div>
      {% endif %}
    {% endif %}
  </div>
</div>
